# 検証チェックリスト

このドキュメントは、実装した変更が正しく動作することを確認するためのチェックリストです。

## 📋 事前準備

### データベースの更新

- [ ] Supabaseダッシュボードにログイン
- [ ] SQL Editorを開く
- [ ] 以下のいずれかを選択：
  - [ ] **既存データを保持する場合**: `alter_tables.sql`の内容をコピー＆実行
  - [ ] **データをリセットする場合**: `recreate_tables.sql`の内容をコピー＆実行
- [ ] SQLが正常に実行されたことを確認
- [ ] エラーがないことを確認

### データベース確認

実行後、以下のSQLで確認できます：

```sql
-- テーブルの存在確認
SELECT table_name FROM information_schema.tables 
WHERE table_schema = 'public' 
ORDER BY table_name;

-- インデックスの確認
SELECT indexname, tablename 
FROM pg_indexes 
WHERE schemaname = 'public' 
ORDER BY tablename, indexname;

-- access_logsテーブルの構造確認
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_name = 'access_logs';
```

期待される結果：
- users, notes, access_logsテーブルが存在
- 4つのインデックスが存在（idx_notes_user_id, idx_notes_updated_at, idx_access_logs_user_id, idx_access_logs_created_at）
- access_logs.user_idがNOT NULL
- access_logs.note_idがNULL可能

## 🧪 機能テスト

### 1. ログイン機能

- [ ] index.htmlにアクセス
- [ ] 12桁のパスコードを入力してログイン
- [ ] または「🎲 ランダム生成」ボタンでパスコードを生成
- [ ] ログインが成功する
- [ ] app.htmlに遷移する

### 2. ログインID表示（app.html）

- [ ] ログイン後、ヘッダーに「ログインID (パスキー): 」が表示される
- [ ] パスコードが正しく表示される（12桁の数字）
- [ ] 等幅フォントで表示される
- [ ] プライマリカラー（青色）で表示される
- [ ] モバイル画面でも正しく表示される

#### 確認方法
1. ブラウザの開発者ツールを開く（F12）
2. Consoleタブで以下を実行：
```javascript
console.log('Passcode:', sessionStorage.getItem('passcode'));
```
3. 画面に表示されているパスコードと一致することを確認

### 3. メモの作成・編集

- [ ] 「+ 新規作成」ボタンをクリック
- [ ] 新しいメモが作成される
- [ ] メモのタイトルを編集できる
- [ ] 「編集」ボタンをクリック
- [ ] メモの内容を編集できる
- [ ] 「保存」ボタンで保存できる
- [ ] Markdownがプレビューされる

### 4. ログ確認ページ

- [ ] 「📊 ログ確認」ボタンをクリック
- [ ] logs.htmlに遷移する
- [ ] ヘッダーにログインID（パスキー）が表示される
- [ ] アクセスログが表示される
- [ ] 「閲覧」「編集」のログが記録されている
- [ ] IPアドレス、ブラウザ、OS、デバイス情報が表示される

### 5. パスコード変更

- [ ] 「パスコード変更」ボタンをクリック
- [ ] モーダルが表示される
- [ ] 新しいパスコードを入力（12桁）
- [ ] 確認用パスコードを入力
- [ ] 「変更」ボタンをクリック
- [ ] パスコードが変更される
- [ ] ヘッダーの表示が新しいパスコードに更新される

#### 確認方法
変更後、以下を確認：
```javascript
console.log('Updated Passcode:', sessionStorage.getItem('passcode'));
```

### 6. レスポンシブデザイン

#### デスクトップ表示
- [ ] ヘッダーがワンライン表示される
- [ ] ログインIDが左側に表示される
- [ ] ボタンが右側に表示される

#### モバイル表示
- [ ] ブラウザウィンドウを狭くする（768px以下）
- [ ] ヘッダーが縦積み表示になる
- [ ] ログインIDが中央に表示される
- [ ] ボタンが下段に表示される
- [ ] すべて読みやすく表示される

### 7. セッション管理

- [ ] ブラウザのタブを閉じる
- [ ] 新しいタブで再度ログイン
- [ ] ヘッダーにパスコードが表示される

#### sessionStorageの確認
開発者ツールのApplicationタブで確認：
- [ ] sessionStorage > userId が存在
- [ ] sessionStorage > passcode が存在

## 🔒 セキュリティテスト

### XSS対策

- [ ] パスコードに特殊文字（<, >, &）が含まれていても正しく表示される
- [ ] HTMLタグが実行されない

#### テスト方法
開発者ツールのConsoleで実行：
```javascript
sessionStorage.setItem('passcode', '<script>alert("XSS")</script>');
location.reload();
```
期待される結果：
- alertが実行されない
- タグがそのまま文字列として表示される

### セッション管理

- [ ] ブラウザを完全に閉じる
- [ ] ブラウザを再起動
- [ ] アプリにアクセス
- [ ] ログイン画面にリダイレクトされる（sessionStorageがクリアされている）

## 📊 パフォーマンステスト

### メモ一覧の読み込み速度

- [ ] 複数のメモ（10個以上）を作成
- [ ] ページをリロード
- [ ] メモ一覧が素早く表示される（1秒以内）

### ログの読み込み速度

- [ ] 複数のログ（20個以上）を生成（メモの閲覧・編集を繰り返す）
- [ ] ログ確認ページにアクセス
- [ ] ログ一覧が素早く表示される（1秒以内）

## 🐛 エラーハンドリング

### パスコードが存在しない場合

開発者ツールのConsoleで実行：
```javascript
sessionStorage.removeItem('passcode');
location.reload();
```

期待される結果：
- [ ] ログイン画面にリダイレクトされる
- [ ] エラーが表示されない

### 無効なパスコード

- [ ] ログイン画面で11桁のパスコードを入力
- [ ] 「パスコードは12桁の数字で入力してください」と表示される
- [ ] 文字を含むパスコードを入力
- [ ] 「パスコードは12桁の数字で入力してください」と表示される

## 📱 モバイルテスト

### iOS Safari
- [ ] iPhone/iPadでアクセス
- [ ] ログインIDが表示される
- [ ] レスポンシブデザインが正しく動作する
- [ ] タップ操作が正常に動作する

### Android Chrome
- [ ] Android端末でアクセス
- [ ] ログインIDが表示される
- [ ] レスポンシブデザインが正しく動作する
- [ ] タップ操作が正常に動作する

## 🌐 ブラウザ互換性

- [ ] Chrome（最新版）
- [ ] Firefox（最新版）
- [ ] Safari（最新版）
- [ ] Edge（最新版）

各ブラウザで以下を確認：
- [ ] ログインIDが表示される
- [ ] スタイルが正しく適用される
- [ ] 機能が正常に動作する

## 📝 ドキュメント確認

- [ ] README.mdが更新されている
- [ ] DATABASE_SCHEMA_FIX.mdが存在する
- [ ] IMPLEMENTATION_SUMMARY_JA.mdが存在する
- [ ] alter_tables.sqlが存在する
- [ ] recreate_tables.sqlが存在する
- [ ] すべてのドキュメントが日本語で記述されている
- [ ] コードコメントが適切に記載されている

## ✅ 最終確認

### 機能要件
- [x] ログが記録される（メモの閲覧・編集）
- [x] ログインID（パスキー）が表示される
- [x] データベーススキーマが明確化されている
- [x] SQLファイルが提供されている

### 非機能要件
- [x] レスポンシブデザイン対応
- [x] セキュリティ対策（XSS、sessionStorage）
- [x] パフォーマンス最適化（インデックス）
- [x] ドキュメント整備

### ユーザー体験
- [x] 直感的なUI
- [x] 一貫したデザイン
- [x] エラーメッセージが分かりやすい
- [x] モバイルでも使いやすい

## 🚀 デプロイ前チェック

- [ ] すべてのテストが完了
- [ ] エラーがない
- [ ] ドキュメントが完成している
- [ ] コードレビューが完了
- [ ] バックアップが取得されている（重要）

## 📞 問題が発生した場合

### ログインIDが表示されない
1. ブラウザの開発者ツールを開く
2. Consoleでエラーを確認
3. sessionStorageにpasscodeが存在するか確認
4. JavaScriptが正しく読み込まれているか確認

### SQLエラーが発生する
1. エラーメッセージを確認
2. テーブルが既に存在する場合、`recreate_tables.sql`を使用
3. インデックスが既に存在する場合、エラーを無視（問題なし）
4. RLSポリシーのエラーの場合、既存ポリシーを削除してから再作成

### パフォーマンスが遅い
1. インデックスが正しく作成されているか確認
2. データ量が多い場合、古いログを削除
3. ブラウザのキャッシュをクリア
4. ネットワーク速度を確認

---

**検証担当者**: _________________  
**検証日**: _________________  
**結果**: ☐ 合格 / ☐ 不合格  
**備考**: _________________
